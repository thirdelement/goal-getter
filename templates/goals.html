{% extends "base.html" %}
{% block header %}
<h4>Goals</h4>
{% endblock %}

{% block content %}
<div>
  <form method="POST" action="{{ url_for('search') }}">
    <!-- Search box -->
    <div class="form-group row">
      <i class="d-none d-md-inline offset-md-1 col-md-1 fas fa-search fa-lg"></i>
      <label for="query" class="col-form-label"></label>
      <div class="col-md-6">
        <input type="text" class="form-control" id="query" name="query" minlength="5" maxlength="70" placeholder="Search Goals" required>
      </div>
      <div class="col-md-4">
        <!-- Reset button -->
        <a href="{{ url_for('get_goals') }}" role="button" class="ml-1 ml-md-0 mt-1 mt-md-0 float-right float-md-left btn btn-secondary acc-header">Reset</a>
        <!-- Submit button -->
        <button type="submit" class="float-right float-md-left ml-md-1 mt-1 mt-md-0 btn btn-primary">Search</button>
      </div>
    </div>
  </form>
</div>

<div id="accordion">
  {% for goal in goals %}
  {% if goal.share == "checked" %}
  <!-- Accordion header with buttons -->
  <h4>
    {% if session.user|lower == goal.created_by|lower %}
    <!-- Button trigger modal -->
    <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#deleteModal_{{ goal._id }}" onclick=>
      Delete
    </button>
    <a href="{{ url_for('complete_goal', goal_id=goal._id) }}" onclick="event.stopPropagation()" role="button"
      class="btn btn-primary">Done</a>
    <!-- Add onclick event to enable link.  Source: https://stackoverflow.com/questions/332384/jquery-accordion-links-dont-work -->
    <a href="{{ url_for('edit_goal', goal_id=goal._id) }}" onclick="event.stopPropagation()" role="button"
      class="btn btn-secondary acc-header">Edit</a>
    {% endif %}
    <span id="accordion-text" class="text-left font-weight-bold">{{ goal.goal_name }} : </span>{{ goal.target_date }}
  </h4>
  <!-- Accordion content-->
  <div>
    <p>Description: {{ goal.succeed_description }}</p>
    <p>Effort: {{ goal.effort }}</p>
    <p>Actions completed already: {{ goal.previous_action }}</p>
    <p>Confidence Level: {{ goal.confidence_level }}</p>
    <p>What's holding me back: {{ goal.holding_back_description }}</p>
    <p>What will make me believe: {{ goal.believe_description }}</p>
    <p>Possible courses of action:</p>
    <ol>
      {% for course_of_action in goal.course_of_action %}
      <li>{{ course_of_action }}</li>
      {% endfor %}
    </ol>
    <p>Possible courses of action1:</p>
    <ol>
      {% for course_of_action1 in goal.course_of_action1 %}
      <li>{{ course_of_action1 }}</li>
      {% endfor %}
    </ol>

    <p>Chosen course of action:</p>
    <ul>
      <li>{{ goal.chosen_coa }}</li>
    </ul>

    <p>Start date: {{ goal.target_date2 }}</p>
    <p>Will the action meet your goal: {{ goal.meet_goal }}</p>
    <p>Obstacles: {{ goal.obstacles }}</p>
    <p>Support required: {{ goal.what_support }}</p>
    <p>How you will get support: {{ goal.how_support }}</p>
    <p>Liklihood of completing: {{ goal.likelihood }}</p>
    <p>Sharing: {{ goal.share }}</p>
    <p class="font-italic">By: {{ goal.created_by }}</p>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="deleteModal_{{ goal._id }}" tabindex="-1" aria-labelledby="ModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="">Confirm Deletion</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete <span class="font-weight-bold"> {{ goal.goal_name }}</span> ?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <a href="{{ url_for('delete_goal', goal_id=goal._id) }}" role="button" class="btn btn-danger">Delete</a>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
  {% endfor %}
</div>
{% endblock %}

<